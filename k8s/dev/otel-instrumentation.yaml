apiVersion: opentelemetry.io/v1alpha1
kind: Instrumentation
metadata:
  name: otel-auto-instrumentation
  namespace: java-app-dev
spec:
  exporter:
    endpoint: http://alloy.observability.svc.cluster.local:4317
  env:
    - name: OTEL_EXPORTER_OTLP_PROTOCOL
      value: "grpc"
    # Plaintext OTLP gRPC (no TLS) for in-cluster collector endpoint.
    - name: OTEL_EXPORTER_OTLP_INSECURE
      value: "true"
  propagators:
    - tracecontext
    - baggage
  sampler:
    type: parentbased_traceidratio
    argument: "1"
  java:
    env:
      - name: OTEL_LOGS_EXPORTER
        value: "none"
      - name: OTEL_TRACES_EXPORTER
        value: "none"
      - name: OTEL_JAVAAGENT_LOGGING
        value: "none"
      - name: OTEL_EXPORTER_OTLP_METRICS_DEFAULT_HISTOGRAM_AGGREGATION
        value: "BASE2_EXPONENTIAL_BUCKET_HISTOGRAM"
      - name: OTEL_JAVA_ENABLED_RESOURCE_PROVIDERS
        value: "io.opentelemetry.instrumentation.resources.AttributeResourceProvider,io.opentelemetry.instrumentation.resources.ContainerResourceProvider"
      - name: OTEL_SEMCONV_STABILITY_OPT_IN
        value: "database,jvm"
